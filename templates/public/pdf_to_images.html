{% extends "public/partial/base.html" %} 
{% load static %}
{% block navbar %}
{% include "public/partial/navbar.html" %}
{% endblock navbar %}
{% block main %}
<!-- Hero Section -->
<div class="hero">
    <h1>Convert PDF to Images</h1>
    <p>Upload your PDF files and convert them to images!</p>
</div>

<!-- Form Section -->
<div class="form-container mt-3 mb-3 p-3">
    <h2>Convert PDF to Images</h2>
    <form id="pdfForm" enctype="multipart/form-data" method="POST">
        {% csrf_token %}
        <div class="mb-3">
            <label for="pdfFile" class="form-label">Upload PDF</label>
            <input type="file" id="pdfFile" name="pdf_file" class="form-control" accept="application/pdf" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Convert</button>
    </form>

    <!-- Progress bar -->
    <div id="progressWrapper" class="mt-4" style="display: none;">
        <label for="progressBar" class="form-label">Processing</label>
        <div class="progress">
            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
    </div>

    <!-- Result Section -->
    <div id="result" class="mt-4"></div>
</div>

<style>
    .hero {
        padding: 4rem 0 !important;
        text-align: center !important;
        background: linear-gradient(135deg, #005b31, #0057A0) !important;
        color: white !important;
    }

    .hero h1 {
        font-size: 2rem !important;
        font-weight: bold !important;
        animation: fadeInUp 2s ease-out !important;
    }

    .hero p {
        font-size: 1rem !important;
        margin-top: 0.5rem !important;
        animation: fadeInUp 2s ease-out 0.5s !important;
    }

    .form-container {
        max-width: 600px;
        margin: auto;
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .form-container .form-label {
        font-weight: bold;
    }

    .form-container button {
        background-color: #0057A0;
        border: none;
        color: white;
    }
</style>

<script src="{% static 'public/js/jquery-3.6.0.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/kartik-fileinput/js/fileinput.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/kartik-fileinput/css/fileinput.min.css" rel="stylesheet">

<script>
    $(document).ready(function () {
        $("#pdfFile").fileinput({
            showUpload: false,
            showRemove: false,
            allowedFileExtensions: ['pdf'],
            maxFileSize: 10000,
            language: 'en',
        });

        $("#pdfForm").on("submit", function (e) {
            e.preventDefault();
            let formData = new FormData(this);

            $("#progressWrapper").show();

            fetch("{% url 'pdf_to_images' %}", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                let resultDiv = document.getElementById("result");
                if (data.images) {
                    resultDiv.innerHTML = "<h2>Converted Images:</h2>";
                    data.images.forEach(image => {
                        resultDiv.innerHTML += `<img src="${image}" width="200"><br>`;
                    });
                } else if (data.zip) {
                    resultDiv.innerHTML = `<h2>Download ZIP:</h2><a href="${data.zip}" class="btn btn-success" download>Download ZIP</a>`;
                }

                $("#progressWrapper").hide();
                $("#progressBar").css("width", "0%");
            })
            .catch(error => {
                alert("Error: " + error);
                $("#progressWrapper").hide();
            });

            let progress = 0;
            let interval = setInterval(function() {
                progress += 5;
                $("#progressBar").css("width", progress + "%");
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        });
    });
</script>

{% endblock main %}
{% block footer %}
{% include "public/partial/footer.html" %}
{% endblock footer %}
{% block modal %}
{% include "public/partial/modal.html" %}
{% endblock modal %}
{% block scripts %}
{% include "public/partial/scripts.html" %}
{% endblock scripts %}
